(()=>{var e={};e.id=628,e.ids=[628],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3263:e=>{"use strict";e.exports=import("firebase-admin/app")},79637:e=>{"use strict";e.exports=import("firebase-admin/auth")},72929:e=>{"use strict";e.exports=import("firebase-admin/firestore")},21983:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{patchFetch:()=>c,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>p});var a=r(88797),i=r(10042),n=r(58492),o=r(79950),u=e([o]);o=(u.then?(await u)():u)[0];let l=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"/home/shan/Desktop/Shan/buzzplaymv/app/api/admin/users/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:p,serverHooks:m}=l;function c(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:p})}s()}catch(e){s(e)}})},78031:()=>{},35303:()=>{},79950:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{GET:()=>u,dynamic:()=>l,runtime:()=>c});var a=r(59540),i=r(96424),n=r(78051),o=e([i]);i=(o.then?(await o)():o)[0];let c="nodejs",l="force-dynamic";async function u(e){try{let e=(0,n.cookies)(),t=(await e).get("adminLoggedIn")?.value;if(!t||"true"!==t)return a.NextResponse.json({error:"Unauthorized"},{status:401});console.log("Fetching all users from Firestore...");let r=i.adminDb.collection("users"),s=await r.get();if(console.log(`Found ${s.size} users in database`),s.empty)return console.log("No users found in database"),a.NextResponse.json({users:[]});let o=await Promise.all(s.docs.map(async e=>{let t=e.data();console.log("Processing user:",{id:e.id,email:t.email});try{let s=r.doc(e.id).collection("receipts"),a=(await s.orderBy("uploadDate","desc").get()).docs.map(e=>{let t=e.data();return{id:e.id,url:t.url||"",date:t.date||"",amount:t.amount||"",planName:t.planName||"",status:t.status||"pending",uploadDate:t.uploadDate||t.date||""}});return console.log(`Fetched ${a.length} receipts for user ${e.id}`),{id:e.id,email:t.email||"",embyUserId:t.embyUserId||"",subscriptionStatus:t.subscriptionStatus||"inactive",subscriptionEnd:t.subscriptionEnd||null,plan:t.plan||"",paymentReceipts:a,createdAt:t.createdAt||null,lastLoginAt:t.lastLoginAt||null,emailVerified:t.emailVerified||!1}}catch(r){return console.error(`Error processing user ${e.id}:`,r),{id:e.id,email:t.email||"",embyUserId:t.embyUserId||"",subscriptionStatus:t.subscriptionStatus||"inactive",subscriptionEnd:t.subscriptionEnd||null,plan:t.plan||"",paymentReceipts:[],createdAt:t.createdAt||null,lastLoginAt:t.lastLoginAt||null,emailVerified:t.emailVerified||!1}}}));return console.log(`Successfully processed ${o.length} users`),a.NextResponse.json({users:o})}catch(e){return console.error("Error fetching users:",e),a.NextResponse.json({error:"Failed to fetch users"},{status:500})}}s()}catch(e){s(e)}})},96424:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{adminDb:()=>c,setAdminClaim:()=>u});var a=r(3263),i=r(72929),n=r(79637),o=e([a,i,n]);[a,i,n]=o.then?(await o)():o,(0,a.getApps)().length||(0,a.initializeApp)({credential:(0,a.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")})});let c=(0,i.getFirestore)();async function u(e){try{return await (0,n.getAuth)().setCustomUserClaims(e,{admin:!0}),!0}catch(e){return console.error("Error setting admin claim:",e),!1}}s()}catch(e){s(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[492,661,51],()=>r(21983));module.exports=s})();